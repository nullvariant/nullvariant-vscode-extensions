#!/usr/bin/env sh
# Auto-regenerate README.md when i18n/en/README.md changes
# This ensures all commits are signed by the developer, not by GitHub Actions

if git diff --cached --name-only | grep -Fxq "extensions/git-id-switcher/docs/i18n/en/README.md"; then
  echo "üìù Regenerating README.md from i18n/en source..."
  (
    cd extensions/git-id-switcher || exit 1
    npm run generate:readme
    git add README.md
  )
  echo "‚úÖ README.md regenerated and staged"
fi

# Auto-regenerate DOCUMENT_HASHES when documentation files change
# Pattern matches: extension .md files, extension LICENSE, monorepo root .md files, monorepo root LICENSE
if git diff --cached --name-only | grep -qE '^(extensions/git-id-switcher/.*\.md|extensions/git-id-switcher/LICENSE|[^/]+\.md|LICENSE)$'; then
  echo "üîí Regenerating DOCUMENT_HASHES..."
  (
    cd extensions/git-id-switcher || exit 1
    node scripts/update-doc-hashes.mjs || exit 1
    git add src/documentation.internal.ts
  )
  # Subshell failure should abort commit
  if [ $? -ne 0 ]; then
    echo "‚ùå Failed to regenerate DOCUMENT_HASHES"
    exit 1
  fi
  echo "‚úÖ DOCUMENT_HASHES regenerated and staged"
fi
