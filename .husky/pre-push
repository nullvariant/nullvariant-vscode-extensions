#!/usr/bin/env sh
# Block direct push to main branch
# All changes must go through Pull Requests

# Get the remote and branch being pushed to
remote="$1"
url="$2"

# Read stdin to get ref info
while read local_ref local_sha remote_ref remote_sha
do
  # Check if pushing to main branch
  if echo "$remote_ref" | grep -qE "refs/heads/(main|master)$"; then
    echo ""
    echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
    echo "❌ Direct push to main/master is blocked"
    echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
    echo ""
    echo "This repository has branch protection enabled."
    echo "Please create a Pull Request instead:"
    echo ""
    echo "  1. Create a feature branch:"
    echo "     git checkout -b fix/your-change"
    echo ""
    echo "  2. Push the branch:"
    echo "     git push -u origin fix/your-change"
    echo ""
    echo "  3. Create a PR:"
    echo "     gh pr create --title \"Your title\" --body \"Description\""
    echo ""
    echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
    exit 1
  fi
done

exit 0
