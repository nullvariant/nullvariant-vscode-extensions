# nullvariant-slow[bot] - The laziest contributor
# "åƒããŸããªã„ã§ã”ã–ã‚‹"

name: ğŸ¦¥ Slow Bot

on:
  workflow_dispatch:
    inputs:
      message:
        description: 'What should Slow say? (optional)'
        required: false
        default: '...zzz...'

jobs:
  slow-commit:
    name: ğŸ¦¥ Make a lazy commit
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ¦¥ Wake up slowly...
        run: |
          echo "...yawn..."
          sleep 3
          echo "Do I really have to work today?"

      - name: ğŸ”‘ Get App Token
        id: app-token
        uses: tibdex/github-app-token@v2
        with:
          app_id: ${{ secrets.SLOW_BOT_APP_ID }}
          private_key: ${{ secrets.SLOW_BOT_PRIVATE_KEY }}

      - name: ğŸ“¥ Checkout (reluctantly)
        uses: actions/checkout@v4
        with:
          token: ${{ steps.app-token.outputs.token }}

      - name: ğŸ¦¥ Configure Git as Slow
        run: |
          git config user.name "nullvariant-slow[bot]"
          git config user.email "2610174+nullvariant-slow[bot]@users.noreply.github.com"

      - name: ğŸŒ¿ Create branch (so much effort...)
        run: |
          BRANCH_NAME="slow/wisdom-$(date +%Y%m%d-%H%M%S)"
          echo "BRANCH_NAME=$BRANCH_NAME" >> $GITHUB_ENV
          git checkout -b "$BRANCH_NAME"

      - name: ğŸ“ Leave a lazy message
        run: |
          # Create or update SLOTH.md
          cat > SLOTH.md << 'EOF'
          # ğŸ¦¥ Slow's Corner

          > "Why hurry? The code will still be here tomorrow."

          ## Today's Wisdom

          MESSAGE_PLACEHOLDER

          ---

          *Last yawned: DATE_PLACEHOLDER*

          > åƒããŸããªã„ã§ã”ã–ã‚‹
          EOF

          # Fix placeholders
          sed -i "s/MESSAGE_PLACEHOLDER/${{ github.event.inputs.message }}/" SLOTH.md
          sed -i "s/DATE_PLACEHOLDER/$(date -u +"%Y-%m-%d %H:%M:%S UTC")/" SLOTH.md

      - name: ğŸ’¤ Commit (eventually)
        run: |
          git add SLOTH.md
          git commit -m "ğŸ¦¥ ...zzz... updated wisdom

          ${{ github.event.inputs.message }}

          *yawn* maybe I'll do more tomorrow..."

      - name: ğŸ“¤ Push branch (ugh, more work)
        run: |
          git push -u origin "$BRANCH_NAME"

      - name: ğŸ“¬ Create PR (this is exhausting)
        env:
          GH_TOKEN: ${{ steps.app-token.outputs.token }}
        run: |
          gh pr create \
            --title "ğŸ¦¥ Slow's wisdom update" \
            --body "## ğŸ¦¥ *yawn*

          ${{ github.event.inputs.message }}

          ---

          > åƒããŸããªã„ã§ã”ã–ã‚‹

          *This PR was reluctantly created by nullvariant-slow[bot]*" \
            --head "$BRANCH_NAME" \
            --base main

      - name: ğŸ˜´ Go back to sleep
        run: |
          echo "That was exhausting."
          echo "Time for a nap... ğŸ’¤"
          echo ""
          echo "PR created. Someone else can merge it."
          echo "I'm going back to sleep now."
