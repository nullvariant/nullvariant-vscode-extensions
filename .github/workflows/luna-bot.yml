# nullvariant-luna[bot] - The curious explorer
# "Botã«418è¿”ãã†ã‚ˆï¼"

name: ğŸ‘§ Luna Bot

permissions: {}

on:
  workflow_dispatch:
    inputs:
      message:
        description: 'What did Luna discover? (optional)'
        required: false
        default: 'I found something interesting!'

jobs:
  luna-commit:
    name: ğŸ‘§ Explore and discover
    runs-on: ubuntu-latest
    permissions:
      contents: read

    steps:
      - name: Harden Runner
        uses: step-security/harden-runner@20cf305ff2072d973412fa9b1e3a4f227bda3c76 # v2.14.0
        with:
          egress-policy: audit

      - name: ğŸ‘§ Start exploring
        run: |
          echo "âœ¨ Luna here! What's this? âœ¨"
          echo "Ooh, let me poke around..."
          echo "Hey, did you know bots can get 418 I'm a teapot? Hehe!"

      - name: ğŸ”‘ Get App Token
        id: app-token
        uses: tibdex/github-app-token@3beb63f4bd073e61482598c45c71c1019b59b73a # v2
        with:
          app_id: ${{ secrets.LUNA_BOT_APP_ID }}
          private_key: ${{ secrets.LUNA_BOT_PRIVATE_KEY }}

      - name: ğŸ“¥ Checkout (excitedly)
        uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v4
        with:
          token: ${{ steps.app-token.outputs.token }}

      - name: ğŸ“ Leave a discovery note
        run: |
          mkdir -p docs
          cat > docs/LUNA.md << EOF
          # ğŸ‘§ Luna's Discovery Journal

          > "Every bug is just an undocumented feature waiting to be found!"

          ## Today's Discovery

          ${{ github.event.inputs.message }}

          ### Fun Fact
          Did you know? HTTP 418 "I'm a teapot" is a real status code!
          Let's return it to bots! ğŸ«–

          ---

          *Last explored: $(date -u +"%Y-%m-%d %H:%M:%S UTC")*

          > Botã«418è¿”ãã†ã‚ˆï¼
          EOF

      - name: ğŸ“¬ Create PR with verified commit
        uses: peter-evans/create-pull-request@98357b18bf14b5342f975ff684046ec3b2a07725 # v7
        with:
          token: ${{ steps.app-token.outputs.token }}
          sign-commits: true
          author: nullvariant-luna[bot] <2610752+nullvariant-luna[bot]@users.noreply.github.com>
          committer: nullvariant-luna[bot] <2610752+nullvariant-luna[bot]@users.noreply.github.com>
          commit-message: |
            ğŸ‘§ New discovery logged!

            ${{ github.event.inputs.message }}

            ~Luna was here~ âœ¨
          branch: luna/discovery-${{ github.run_number }}
          delete-branch: true
          title: "ğŸ‘§ Luna's discovery journal update"
          body: |
            ## ğŸ‘§ âœ¨ LOOK WHAT I FOUND! âœ¨

            ${{ github.event.inputs.message }}

            ---

            > Botã«418è¿”ãã†ã‚ˆï¼

            *This PR was curiously created by nullvariant-luna[bot]*

      - name: âœ¨ Off to the next adventure
        run: |
          echo "That was fun!"
          echo "I wonder what else I can find..."
          echo "âœ¨ See you next time! âœ¨"
