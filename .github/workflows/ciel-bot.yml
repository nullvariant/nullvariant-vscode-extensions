# nullvariant-ciel[bot] - The sky messenger
# "ã¾ã‚ã¾ã‚ã€ã»ã©ã»ã©ã«ã€‚"

name: ğŸ•Šï¸ Ciel Bot

permissions: {}

on:
  workflow_dispatch:
    inputs:
      message:
        description: 'What should Ciel whisper? (optional)'
        required: false
        default: 'Peace and balance...'

jobs:
  ciel-commit:
    name: ğŸ•Šï¸ Descend from the sky
    runs-on: ubuntu-latest
    permissions:
      contents: read

    steps:
      - name: ğŸ•Šï¸ Arrive gracefully
        run: |
          echo "~~ floating down from the clouds ~~"
          echo "Everything in moderation..."

      - name: ğŸ”‘ Get App Token
        id: app-token
        uses: tibdex/github-app-token@3beb63f4bd073e61482598c45c71c1019b59b73a # v2
        with:
          app_id: ${{ secrets.CIEL_BOT_APP_ID }}
          private_key: ${{ secrets.CIEL_BOT_PRIVATE_KEY }}

      - name: ğŸ“¥ Checkout (gently)
        uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4
        with:
          token: ${{ steps.app-token.outputs.token }}

      - name: ğŸ“ Leave a peaceful message
        run: |
          mkdir -p docs
          cat > docs/CIEL.md << EOF
          # ğŸ•Šï¸ Ciel's Sky Notes

          > "The sky sees all, judges none."

          ## Today's Whisper

          ${{ github.event.inputs.message }}

          ---

          *Last descended: $(date -u +"%Y-%m-%d %H:%M:%S UTC")*

          > ã¾ã‚ã¾ã‚ã€ã»ã©ã»ã©ã«ã€‚
          EOF

      - name: ğŸ“¬ Create PR with verified commit
        uses: peter-evans/create-pull-request@22a9089034f40e5a961c8808d113e2c98fb63676 # v7
        with:
          token: ${{ steps.app-token.outputs.token }}
          sign-commits: true
          author: nullvariant-ciel[bot] <2610776+nullvariant-ciel[bot]@users.noreply.github.com>
          committer: nullvariant-ciel[bot] <2610776+nullvariant-ciel[bot]@users.noreply.github.com>
          commit-message: |
            ğŸ•Šï¸ A message from above

            ${{ github.event.inputs.message }}

            ~~ drifting back to the clouds ~~
          branch: ciel/whisper-${{ github.run_number }}
          delete-branch: true
          title: "ğŸ•Šï¸ Ciel's sky notes update"
          body: |
            ## ğŸ•Šï¸ *A gentle breeze*

            ${{ github.event.inputs.message }}

            ---

            > ã¾ã‚ã¾ã‚ã€ã»ã©ã»ã©ã«ã€‚

            *This PR was peacefully delivered by nullvariant-ciel[bot]*

      - name: â˜ï¸ Return to the sky
        run: |
          echo "Balance has been restored."
          echo "~~ ascending back to the clouds ~~"
